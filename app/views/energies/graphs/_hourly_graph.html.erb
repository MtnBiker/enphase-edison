<!-- app/views/energies/_hourly_graph.erb.html -->
<div id="graph">
  <hr class="border-bottom border-3 border-dark">

    <!-- Display the graph using the @the_date variable if it's defined -->
    <% if defined? the_date %>
      <!-- <p>Selected Date: <%= the_date %></p> -->
    <% else %>
      <!-- <p>No date selected yet</p> -->
      <% the_date = Date.current - 1.month %>
    <% end %>

  <div class="text-center font-weight-bold">
    <!-- Testing this way of displaying, avoids one error -->
    <%#= "Got the_date" if defined?(the_date) && the_date %>
    <h4>Hour by Hour for <%= the_date.strftime("%d %b %Y") %></h4>
  
    <!-- For some reason just picking a date, it is 8 hours short, probably a time zone issue, but adding 0 hours fixes it UGLY -->
   <% the_date = the_date + 0.hour %>
  <!-- Could pass in a variable for number of days or do that in hourly -->
    <% time_span = the_date..the_date + 24.hour %>
    
    <%= line_chart [
    {name: "Enphase Produced", data: Hour.where(datetime: time_span).pluck(:datetime, :enphase)},
    {name: "Sent to SCE", data: Hour.where(datetime: time_span).pluck(:datetime, :to_sce)},
    {name: "From SCE", data: Hour.where(datetime: time_span).pluck(:datetime, :from_sce)},
    {name: "Used", data: Hour.where(datetime: time_span).pluck(:datetime, :used)}
    ]%>    
  </div>
  
  <hr class="border-bottom border-3 border-dark">
</div>
